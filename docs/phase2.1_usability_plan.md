# Phase 2.1: ユーザビリティ向上 - 実装計画

## 概要
ユーザビリティを向上させる機能を実装し、操作性を大幅に改善します。

## 実装タスク

### 1. ドラッグ&ドロップによるステップ順序変更
- **ライブラリ**: @dnd-kit/sortable
- **対象画面**:
  - テンプレート編集画面（ステップの順序変更）
  - ケース詳細画面（ステップインスタンスの順序変更）
- **実装内容**:
  - ドラッグハンドルの追加
  - ドロップゾーンの視覚的フィードバック
  - 順序変更後の自動保存
  - アニメーション効果

### 2. 一括操作機能
- **対象画面**: ケース一覧、ステップ一覧
- **実装内容**:
  - チェックボックスによる複数選択
  - 全選択/全解除ボタン
  - 一括ステータス更新
  - 一括担当者割り当て
  - 一括削除（確認ダイアログ付き）
  - 選択数の表示

### 3. ショートカットキー対応
- **グローバルショートカット**:
  - `Ctrl/Cmd + N`: 新規作成
  - `Ctrl/Cmd + S`: 保存
  - `Ctrl/Cmd + F`: 検索
  - `Ctrl/Cmd + /`: ショートカット一覧表示
  - `Esc`: モーダル/ダイアログを閉じる
- **リスト操作**:
  - `Space`: 選択/選択解除
  - `Shift + Click`: 範囲選択
  - `↑/↓`: フォーカス移動
  - `Enter`: 詳細表示
- **実装方法**:
  - カスタムフックの作成（useKeyboardShortcuts）
  - ショートカットヘルプモーダル

### 4. アンドゥ/リドゥ機能
- **対象操作**:
  - ステップ順序変更
  - ステータス更新
  - テキスト編集
  - 削除操作
- **実装内容**:
  - 操作履歴スタックの管理
  - 最大30回の履歴保持
  - `Ctrl/Cmd + Z`: アンドゥ
  - `Ctrl/Cmd + Shift + Z`: リドゥ
  - 履歴表示パネル

## 技術スタック

### フロントエンド
- **@dnd-kit/sortable**: ドラッグ&ドロップ
- **react-hotkeys-hook**: ショートカットキー管理
- **immer**: イミュータブルな状態管理
- **zustand**: アンドゥ/リドゥの状態管理

### バックエンド
- 一括更新用のAPIエンドポイント追加
- WebSocketによるリアルタイム同期（オプション）

## 実装順序

1. **Week 1**: ドラッグ&ドロップ機能
   - ライブラリセットアップ
   - テンプレート編集画面実装
   - ケース詳細画面実装
   - テスト作成

2. **Week 2**: 一括操作機能
   - 複数選択UI実装
   - 一括操作API実装
   - 確認ダイアログ実装
   - テスト作成

3. **Week 3**: ショートカットキー＆アンドゥ/リドゥ
   - ショートカット管理システム実装
   - アンドゥ/リドゥスタック実装
   - ヘルプモーダル実装
   - 統合テスト

## 成功指標

- ドラッグ&ドロップ操作の成功率: 100%
- 一括操作の処理時間: 100件で3秒以内
- ショートカットキーの認知率: 80%以上
- アンドゥ/リドゥの動作速度: 100ms以内

## リスクと対策

### リスク
1. ドラッグ&ドロップのモバイル対応
2. 大量データでのパフォーマンス
3. ショートカットキーの競合

### 対策
1. タッチイベント対応ライブラリの使用
2. 仮想スクロール実装
3. コンテキスト別のショートカット管理

## テスト計画

### ユニットテスト
- ドラッグ&ドロップのロジック
- 一括操作のバリデーション
- ショートカットキーの登録/解除
- アンドゥ/リドゥスタック管理

### E2Eテスト
- ドラッグ&ドロップ操作フロー
- 一括選択から更新までのフロー
- ショートカットキーの動作確認
- アンドゥ/リドゥの連続操作

### ユーザビリティテスト
- 実際のユーザーによる操作テスト
- フィードバック収集
- 改善点の特定

## 関連ドキュメント

- [Phase 2 全体計画](./phase2_plan.md)
- [UIデザインガイドライン](./ui_design_guidelines.md)
- [アクセシビリティガイドライン](./accessibility_guidelines.md)