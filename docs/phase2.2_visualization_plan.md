# Phase 2.2: 可視化機能強化 - 実装計画書

## 概要
プロセス管理の可視化機能を大幅に強化し、ユーザーが直感的にプロジェクトの状態を把握できるようにする。

## 実装目標
1. **カレンダービュー**: タイムライン形式での期限管理
2. **カンバンボード**: ステータス別のタスク管理
3. **ダッシュボード強化**: KPI表示とメトリクス可視化
4. **リアルタイム更新**: WebSocketによる即時反映

## 実装タスク詳細

### 1. カレンダービュー実装
#### 1.1 ライブラリ選定と設定
- **FullCalendar** (@fullcalendar/react) の導入
- 日本語化設定
- カスタムスタイリング

#### 1.2 機能実装
- **月表示モード**: ケースの期限をカレンダー上に表示
- **週表示モード**: より詳細なスケジュール表示
- **日表示モード**: 当日のタスク詳細
- **ドラッグ&ドロップ**: 期限の変更
- **色分け表示**: ステータス別の色分け

#### 1.3 データ連携
- ケースとステップの期限データ取得
- 期限変更時のAPI連携
- フィルタリング機能（担当者、ステータス別）

### 2. カンバンボード実装
#### 2.1 コンポーネント設計
- **react-beautiful-dnd** または **@dnd-kit** を使用
- カラム構成: Todo, In Progress, Review, Done
- カスタマイズ可能なカラム

#### 2.2 機能実装
- **カード表示**: ケース/ステップの概要表示
- **ドラッグ&ドロップ**: ステータス変更
- **フィルタリング**: 担当者、優先度、期限別
- **カードの詳細表示**: ホバー/クリックで詳細情報
- **WIP制限**: カラムごとの作業量制限

#### 2.3 パフォーマンス最適化
- 仮想スクロール対応
- 大量データの効率的な表示

### 3. ダッシュボード強化
#### 3.1 KPI表示
- **進捗率**: 全体/個別プロジェクトの進捗
- **期限遵守率**: On-time delivery rate
- **リソース稼働率**: チームメンバーの負荷状況
- **平均リードタイム**: ケース完了までの時間

#### 3.2 グラフ/チャート実装
- **Recharts** または **Chart.js** を使用
- バーンダウンチャート
- ガントチャート改善
- 円グラフ（ステータス分布）
- 折れ線グラフ（トレンド分析）

#### 3.3 ウィジェット設計
- カスタマイズ可能なダッシュボード
- ドラッグ&ドロップでレイアウト変更
- ウィジェットの追加/削除

### 4. リアルタイム更新実装
#### 4.1 WebSocket設定
- **Socket.io** のセットアップ
- NestJS側のGateway実装
- 認証とセキュリティ設定

#### 4.2 イベント設計
- ケース更新イベント
- ステップ状態変更イベント
- コメント追加イベント
- 通知イベント

#### 4.3 クライアント実装
- React Context でWebSocket管理
- 自動再接続機能
- オフライン対応
- 楽観的UI更新

## 技術スタック
### フロントエンド
- **FullCalendar**: カレンダービュー
- **@dnd-kit**: カンバンボード
- **Recharts**: データ可視化
- **Socket.io-client**: WebSocket通信
- **date-fns**: 日付処理

### バックエンド
- **@nestjs/websockets**: WebSocketサーバー
- **socket.io**: リアルタイム通信
- **Redis**: PubSub for scaling

## テスト戦略
### ユニットテスト
- カレンダーコンポーネントのテスト
- カンバンボードのドラッグ&ドロップテスト
- ダッシュボードのKPI計算テスト

### 統合テスト
- WebSocket接続テスト
- リアルタイム更新のテスト
- データ同期のテスト

### E2Eテスト
- カレンダービューの操作フロー
- カンバンボードでのタスク移動
- ダッシュボードのインタラクション

## 実装順序とスケジュール

### Week 1: カレンダービュー
- Day 1-2: ライブラリ設定と基本実装
- Day 3-4: ドラッグ&ドロップと詳細機能
- Day 5: テスト作成

### Week 2: カンバンボード
- Day 1-2: 基本レイアウトと表示
- Day 3-4: ドラッグ&ドロップ実装
- Day 5: フィルタリングとテスト

### Week 3: ダッシュボードとWebSocket
- Day 1-2: KPI表示とグラフ実装
- Day 3-4: WebSocket統合
- Day 5: 統合テストとデバッグ

## 成功指標
1. **パフォーマンス**: 1000件のデータでも2秒以内に表示
2. **リアルタイム性**: 更新から1秒以内に他ユーザーに反映
3. **使いやすさ**: ドラッグ&ドロップ操作のスムーズさ
4. **可視性**: KPIの一目での把握

## リスクと対策
1. **WebSocketの接続安定性**
   - 対策: 自動再接続とフォールバック機構

2. **大量データのパフォーマンス**
   - 対策: ページネーションと仮想スクロール

3. **ブラウザ互換性**
   - 対策: Polyfillの適用とプログレッシブエンハンスメント

## 参考資料
- [FullCalendar Documentation](https://fullcalendar.io/docs)
- [Socket.io Documentation](https://socket.io/docs/)
- [Recharts Examples](https://recharts.org/en-US/examples)
- [NestJS WebSockets](https://docs.nestjs.com/websockets/gateways)