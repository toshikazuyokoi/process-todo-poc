# 07 画面フロー（v1.1・実装反映版）

## 概要
本ドキュメントは、プロセス指向ToDoアプリケーションの実装されたUI/UXフローを反映したものです。
v1.0から大幅に拡張され、認証フロー、ダッシュボード、検索機能、可視化機能などが追加されています。

## 共通UI方針（Next.js 14）

### 技術基盤
- **フレームワーク**: Next.js 14 (App Router)
- **レンダリング**: SSRベースで初期データ取得
- **状態管理**: React Query + Context API
- **リアルタイム**: WebSocket (Socket.IO)
- **認証**: JWT + リフレッシュトークン
- **時刻表示**: `Intl.DateTimeFormat`でユーザーTZ表示

### UI/UXの基本原則
- **レスポンシブデザイン**: モバイル・タブレット・デスクトップ対応
- **アクセシビリティ**: WCAG 2.1 AA準拠
- **パフォーマンス**: Core Web Vitals最適化
- **ユーザビリティ**: 直感的な操作、キーボードショートカット対応

## 1) 認証フロー（新規追加）

### ログインフロー
```
/login → 認証情報入力 → JWT取得 → /dashboard
```

**画面構成**:
- メールアドレス・パスワード入力フォーム
- 「ログイン状態を保持」チェックボックス
- パスワードリセットリンク
- サインアップページへのリンク

**機能**:
- バリデーション（リアルタイム）
- ログイン失敗時のエラー表示
- アカウントロック時の警告
- リダイレクト機能（ログイン前のページに戻る）

### サインアップフロー
```
/signup → アカウント作成 → メール認証 → /dashboard
```

**画面構成**:
- 名前・メールアドレス・パスワード入力フォーム
- パスワード強度インジケーター
- 利用規約・プライバシーポリシー同意チェックボックス

**機能**:
- パスワード強度チェック
- メールアドレス重複チェック
- メール認証フロー

### 認証状態管理
- **ミドルウェア**: 未認証時の自動リダイレクト
- **トークン管理**: 自動リフレッシュ
- **セッション管理**: アクティビティベースの自動ログアウト

## 2) ダッシュボード（新規追加）

### ホーム画面 (`/dashboard`)

**レイアウト構成**:
```
┌─────────────────────────────────────┐
│ ヘッダー（ナビゲーション・ユーザーメニュー） │
├─────────────────────────────────────┤
│ クイックアクション                    │
├─────────────────────────────────────┤
│ サマリーカード（統計情報）              │
├─────────────────────────────────────┤
│ 進行中案件一覧                       │
├─────────────────────────────────────┤
│ プロセステンプレート一覧               │
└─────────────────────────────────────┘
```

**クイックアクション**:
- 新規案件作成
- テンプレート作成
- ガントチャート表示
- 検索

**サマリー表示**:
- アクティブ案件数
- 今日期限のタスク数
- 遅延中のタスク数
- 利用可能テンプレート数

**進行中案件一覧**:
- 案件タイトル・進捗率・期限・担当者
- ステータス別フィルタリング
- 優先度・期限でのソート

## 3) ナビゲーション・レイアウト

### グローバルナビゲーション
```
┌─────────────────────────────────────┐
│ Logo │ Dashboard │ Cases │ Templates │ Gantt │ Calendar │ Kanban │ Search │ User Menu │
└─────────────────────────────────────┘
```

**ユーザーメニュー**:
- プロフィール設定
- パスワード変更
- 通知設定
- ログアウト

**通知システム**:
- リアルタイム通知（WebSocket）
- 通知バッジ表示
- 通知履歴

## 4) プロセステンプレート管理

### テンプレート一覧 (`/templates`)
- テンプレート一覧表示（カード形式）
- 検索・フィルタリング機能
- 新規作成・編集・削除・複製機能
- バージョン管理

### テンプレート編集 (`/templates/[id]`)
- **ドラッグ&ドロップエディター**: ステップの順序・依存関係編集
- **ステップ詳細設定**: 名前・基準日・オフセット日数・必須成果物
- **依存関係可視化**: フローチャート表示
- **プレビュー機能**: 実際の展開イメージ確認
- **バリデーション**: DAG検証・循環依存チェック

**操作フロー**:
```
テンプレート選択 → D&Dで編集 → プレビュー確認 → 保存 (PUT /templates/:id)
```

## 5) 案件管理

### 案件一覧 (`/cases`)
- **表示形式**: リスト・カード・テーブル切り替え
- **検索・フィルタリング**: タイトル・ステータス・担当者・期限
- **ソート**: 作成日・更新日・期限・優先度
- **バッチ操作**: 複数選択・一括操作

### 案件作成フロー
```
新規作成ボタン → テンプレート選択 → 基本情報入力 → 展開プレビュー → 作成確定
```

**基本情報入力**:
- 案件タイトル
- 目標完了日
- 担当者（初期割り当て）
- 説明・メモ

**展開プレビュー**:
- ステップ一覧・スケジュール表示
- ガントチャート形式でのプレビュー
- 営業日計算結果の確認

### 案件詳細 (`/cases/[id]`)

**タブ構成**:
- **タイムライン**: ステップの時系列表示
- **リスト**: ステップ一覧（フィルタリング・ソート対応）
- **ガント**: ガントチャート表示
- **成果物**: 添付ファイル一覧
- **履歴**: 変更履歴・コメント
- **設定**: 案件設定・権限管理

**ステップ操作**:
- ステータス変更（ドラッグ&ドロップ対応）
- 担当者割り当て
- 期限変更
- ロック・アンロック
- コメント追加

**再計算機能**:
```
再計算ボタン → 条件設定 → プレビュー表示 → 影響差分確認 → 適用確定
```

## 6) 可視化機能

### ガントチャート (`/gantt`)

**表示モード**:
- **案件ビュー**: 案件単位でのガントチャート
- **個人ビュー**: 担当者単位でのタスク表示
- **チームビュー**: チーム単位での作業負荷表示

**機能**:
- **インタラクティブ操作**: ドラッグでの期間変更
- **依存関係表示**: 矢印での依存関係可視化
- **進捗表示**: 完了率の視覚的表示
- **期限管理**: 遅延・期限迫近の強調表示
- **フィルタリング**: ステータス・担当者・期間での絞り込み

### カレンダー (`/calendar`)

**表示形式**:
- 月表示・週表示・日表示
- アジェンダ表示

**機能**:
- **期限表示**: ステップ期限の表示
- **イベント表示**: 会議・休日等の表示
- **ドラッグ&ドロップ**: 期限変更
- **色分け**: ステータス・優先度による色分け

### カンバンボード (`/kanban`)

**カラム構成**:
- TODO・進行中・レビュー中・完了・ブロック中

**機能**:
- **ドラッグ&ドロップ**: ステータス変更
- **カラム設定**: カスタムカラム作成
- **フィルタリング**: 担当者・期限・優先度
- **WIP制限**: 進行中タスク数の制限設定

## 7) 検索機能（新規追加）

### 統合検索 (`/search`)

**検索対象**:
- 案件（タイトル・説明）
- ステップ（名前・コメント）
- テンプレート（名前・説明）
- 成果物（ファイル名・内容）

**検索機能**:
- **全文検索**: Elasticsearch連携
- **ファセット検索**: カテゴリ・ステータス・日付範囲
- **保存検索**: よく使う検索条件の保存
- **検索履歴**: 過去の検索履歴表示

**検索結果表示**:
- 関連度順・日付順ソート
- ハイライト表示
- プレビュー機能

## 8) リアルタイム更新（新規追加）

### WebSocket機能
- **案件更新**: ステップステータス変更の即座反映
- **通知**: リアルタイム通知受信
- **コラボレーション**: 複数ユーザーでの同時編集対応

### 更新通知
- **トースト通知**: 重要な変更の通知
- **バッジ表示**: 未読通知数の表示
- **音声通知**: 重要度に応じた音声アラート

## 9) モバイル対応

### レスポンシブデザイン
- **ブレークポイント**: 320px・768px・1024px・1440px
- **タッチ操作**: スワイプ・ピンチ・タップ対応
- **オフライン対応**: Service Worker活用

### モバイル専用機能
- **プッシュ通知**: 期限通知・ステータス変更通知
- **位置情報**: 現場作業での位置記録
- **カメラ連携**: 成果物の写真撮影・アップロード

## 10) アクセシビリティ・ユーザビリティ

### アクセシビリティ
- **キーボードナビゲーション**: 全機能のキーボード操作対応
- **スクリーンリーダー**: ARIA属性・セマンティックHTML
- **色覚対応**: カラーブラインド対応色設計
- **フォントサイズ**: 可変フォントサイズ対応

### キーボードショートカット
- `Ctrl+N`: 新規案件作成
- `Ctrl+F`: 検索
- `Ctrl+G`: ガントチャート表示
- `Ctrl+K`: カンバンボード表示
- `Esc`: モーダル・ドロワー閉じる

## 変更履歴

### v1.1での主要な追加・変更点

1. **認証フローの完全実装**
   - ログイン・サインアップ画面
   - パスワードリセット機能
   - メール認証フロー

2. **ダッシュボード機能の追加**
   - ホーム画面の実装
   - サマリー表示・クイックアクション

3. **可視化機能の大幅拡張**
   - カンバンボードの実装
   - ガントチャートの詳細化
   - カレンダー機能の追加

4. **検索機能の実装**
   - 統合検索システム
   - ファセット検索・保存検索

5. **リアルタイム機能の追加**
   - WebSocket通信
   - リアルタイム通知システム

6. **ユーザビリティの向上**
   - キーボードショートカット
   - ドラッグ&ドロップ操作
   - モバイル対応強化
